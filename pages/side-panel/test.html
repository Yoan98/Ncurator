<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Document</title>
    </head>

    <body>
    </body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.js"></script>
    <script>
        function calculateTokens(content) {
            // 判断是否包含中文的正则
            const chineseRegex = /[\u4e00-\u9fa5]/;
            // 匹配英文单词和标点的正则
            const englishRegex = /\w+|[^\w\s]/g;

            let totalTokens = 0;

            content.forEach((msg) => {
                if (chineseRegex.test(msg)) {
                    // 如果包含中文，则直接按字符数估算
                    totalTokens += msg.length;
                } else {
                    // 如果是英文，按照单词和标点分割
                    const matches = msg.match(englishRegex) || [];
                    console.log(matches)
                    matches.forEach((match) => {
                        if (/\w+/.test(match)) {
                            // 长单词按每 4 个字符算一个 token
                            totalTokens += Math.ceil(match.length / 8);
                        } else {
                            // 标点符号单独算一个 token
                            totalTokens += 1;
                        }
                    });
                }
            });

            return totalTokens;
        }


        const res = calculateTokens(["你好世界"]);
        console.log(res)
    </script>

</html>